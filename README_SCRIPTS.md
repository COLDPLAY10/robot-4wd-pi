# Скрипты для робота 4WD

## Описание скриптов

### 1. data_collector.py - Сбор данных для диплома

Скрипт для автоматического сбора данных с камеры и ультразвукового датчика. Робот выполняет следующую последовательность:
1. Движение вперед по прямой
2. Поворот на 360° на месте
3. Снова движение вперед по прямой

Во время всего процесса робот делает фотографии с сохранением данных расстояния от ультразвукового датчика.

#### Использование:

```bash
# Базовый запуск с параметрами по умолчанию
python3 data_collector.py

# С указанием директории для сохранения
python3 data_collector.py --output-dir my_data

# С настройкой скорости и интервала фотографирования
python3 data_collector.py --speed 25 --photo-interval 0.3

# Полная настройка
python3 data_collector.py \
    --output-dir corridor_data \
    --speed 20 \
    --photo-interval 0.5 \
    --forward-time 4.0 \
    --rotate-time 3.0
```

#### Параметры:

- `--output-dir, -o` - Директория для сохранения фотографий (по умолчанию: `collected_data`)
- `--speed, -s` - Скорость движения робота (по умолчанию: 20)
- `--photo-interval, -i` - Интервал между фотографиями в секундах (по умолчанию: 0.5)
- `--forward-time, -f` - Время движения вперед в секундах (по умолчанию: 3.0)
- `--rotate-time, -r` - Время поворота на 360° в секундах (по умолчанию: 2.5)

#### Формат имен файлов:

```
photo_0001_20241128_143052_123_dist_45.3cm.jpg
photo_0002_20241128_143052_623_dist_44.8cm.jpg
```

Имя содержит:
- Порядковый номер
- Дату и время (с миллисекундами)
- Расстояние от датчика в сантиметрах

---

### 2. obstacle_detector.py - Детекция цветовых препятствий

Скрипт для детекции препятствий по цвету с использованием камеры и ультразвукового датчика. Робот движется вперед и сканирует окружение на наличие препятствий заданного цвета.

#### Типы препятствий:

- **white** (белый/светлый) - детектирует светлые объекты
- **black** (черный/темно-синий) - детектирует темные и темно-синие объекты
- **mixed** (пестрый) - детектирует разноцветные/пестрые объекты

#### Использование:

```bash
# Детекция белых препятствий
python3 obstacle_detector.py --color white

# Детекция черных/темно-синих препятствий с сохранением фото
python3 obstacle_detector.py --color black --save-photos

# Детекция пестрых препятствий с настройкой директории
python3 obstacle_detector.py --color mixed --save-photos --output-dir patterned_obstacles

# Полная настройка
python3 obstacle_detector.py \
    --color white \
    --save-photos \
    --output-dir white_obstacles \
    --speed 15 \
    --scan-interval 0.2
```

#### Параметры:

- `--color, -c` - **[ОБЯЗАТЕЛЬНО]** Цвет препятствия: `white`, `black`, или `mixed`
- `--save-photos, -s` - Сохранять фотографии при обнаружении препятствий
- `--output-dir, -o` - Директория для сохранения фото (по умолчанию: `obstacle_photos`)
- `--speed` - Скорость движения (по умолчанию: 15)
- `--scan-interval` - Интервал сканирования в секундах (по умолчанию: 0.2)

#### Формат имен файлов:

```
obstacle_white_0001_20241128_143530_456_dist_25.3cm_ratio_0.34.jpg
obstacle_black_0002_20241128_143545_789_dist_28.1cm_ratio_0.42.jpg
```

Имя содержит:
- Тип цвета препятствия
- Порядковый номер
- Дату и время
- Расстояние от датчика
- Процент цвета на кадре

#### Поведение при обнаружении:

1. Робот останавливается
2. LED индикатор мигает цветом препятствия
3. Робот откатывается назад
4. Поворачивает на месте для объезда
5. Продолжает движение

---

## Требования

### Аппаратные:
- Raspberry Pi с подключенным роботом 4WD
- USB камера или Pi Camera
- Ультразвуковой датчик
- RGB LED индикатор

### Программные:
```bash
pip3 install opencv-python numpy
```

---

## Структура проекта

```
robot-4wd-pi/
├── car_adapter.py          # Адаптер управления моторами
├── camera.py               # Модуль работы с камерой
├── ultrasonic.py          # Модуль ультразвукового датчика
├── RGB.py                 # Модуль управления RGB LED
├── data_collector.py      # Скрипт сбора данных
├── obstacle_detector.py   # Скрипт детекции препятствий
├── collected_data/        # Директория с собранными данными (не в git)
└── obstacle_photos/       # Директория с фото препятствий (не в git)
```

---

## Примеры использования

### Сценарий 1: Сбор данных в коридоре вуза

```bash
# Запуск сбора данных с увеличенным временем движения
python3 data_collector.py \
    --output-dir corridor_samples \
    --speed 18 \
    --photo-interval 0.4 \
    --forward-time 5.0 \
    --rotate-time 3.0
```

После выполнения в директории `corridor_samples/` будут сохранены все фотографии с метаданными для дальнейшей разметки и обучения нейросети.

### Сценарий 2: Тестирование детекции белых препятствий

```bash
# Детекция белых объектов с сохранением фото
python3 obstacle_detector.py --color white --save-photos
```

Робот будет двигаться, определять белые препятствия и сохранять фото в директорию `obstacle_photos/`.

### Сценарий 3: Детекция всех типов препятствий

```bash
# Запуск трех экземпляров последовательно для разных цветов
python3 obstacle_detector.py --color white --save-photos --output-dir white_test
python3 obstacle_detector.py --color black --save-photos --output-dir black_test
python3 obstacle_detector.py --color mixed --save-photos --output-dir mixed_test
```

---

## Остановка скриптов

Оба скрипта корректно обрабатывают сигнал прерывания:
- Нажмите `Ctrl+C` для безопасной остановки
- Робот автоматически остановится
- LED индикаторы выключатся
- Ресурсы камеры освободятся

---

## Отладка

### Проблема: Камера не открывается
```bash
# Проверьте список камер
v4l2-ctl --list-devices

# Попробуйте изменить CAMERA_ID в скрипте (обычно 0 или 1)
```

### Проблема: Ультразвуковой датчик не работает
```bash
# Проверьте подключение и запустите тест
python3 -c "from ultrasonic import read_distance_cm_from_bot; print(read_distance_cm_from_bot())"
```

### Проблема: Робот не двигается
```bash
# Проверьте объект bot
python3 -c "import car_adapter; print(car_adapter.bot)"
```

---

## Лицензия

Проект для дипломной работы.

## Автор

Kindasorrow - Дипломный проект

